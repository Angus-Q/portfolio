---
import '../styles/global.css';
import '../styles/fonts.css';
import Footer from '../components/Footer.astro';

interface Props { title?: string; description?: string; heroMode?: boolean; isHomepage?: boolean }
const { title = 'Portfolio', description = 'Personal site', heroMode = false, isHomepage = false } = Astro.props as Props;
---
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="description" content={description} />
    <link rel="icon" type="image/png" href="/favicon.png" />
    <link rel="preconnect" href="https://cal-sans.com">
    <link rel="preload" href="https://cal-sans.com/fonts/CalSans-SemiBold.woff2" as="font" type="font/woff2" crossorigin>
    <title>{title}</title>
  </head>
  <body class={`min-h-screen flex flex-col ${isHomepage ? 'bg-black text-white' : 'bg-white text-gray-900'}`} data-page-theme={isHomepage ? 'dark' : 'light'}>
    <!-- Page transition overlay -->
    <div class={`page-transition ${isHomepage ? 'dark' : ''}`} id="pageTransition"></div>
    
    {!isHomepage && (
    <header class={`container-px max-w-5xl mx-auto w-full py-6 relative ${heroMode ? 'absolute top-0 left-0 right-0 z-10' : ''}`} id="navbar">
      <nav class="flex items-center justify-between">
        <a href="/" class={`font-display text-lg lowercase transition-colors duration-300 clean-underline font-normal ${isHomepage ? 'text-white' : 'text-gray-900'}`}>angus quigley</a>
        
        <!-- Desktop Navigation -->
        <ul class="hidden md:flex gap-6 text-sm font-display">
          <li><a href="/portfolio" class={`clean-underline transition-colors duration-300 ${isHomepage ? 'text-white' : 'text-gray-500 hover:text-gray-700'}`}>portfolio</a></li>
          <li><a href="/about" class={`clean-underline transition-colors duration-300 ${isHomepage ? 'text-white' : 'text-gray-500 hover:text-gray-700'}`}>about</a></li>
          <li><a href="/contact" class={`clean-underline transition-colors duration-300 ${isHomepage ? 'text-white' : 'text-gray-500 hover:text-gray-700'}`}>contact</a></li>
        </ul>
        
        <!-- Mobile Hamburger Menu -->
        <button class="md:hidden flex flex-col gap-1 p-3 relative z-50" id="mobile-menu-btn" aria-label="Toggle menu">
          <span class={`w-5 h-0.5 transition-all duration-300 ${isHomepage ? 'bg-white' : 'bg-gray-900'}`} id="burger-line-1"></span>
          <span class={`w-5 h-0.5 transition-all duration-300 ${isHomepage ? 'bg-white' : 'bg-gray-900'}`} id="burger-line-2"></span>
          <span class={`w-5 h-0.5 transition-all duration-300 ${isHomepage ? 'bg-white' : 'bg-gray-900'}`} id="burger-line-3"></span>
        </button>
        
        <!-- Mobile Menu -->
        <div class="hidden md:hidden fixed top-0 left-0 right-0 bottom-0 bg-white z-40 opacity-0 transition-opacity duration-300" id="mobile-menu">
          <div class="pt-20 h-full flex flex-col justify-center transform translate-y-4 transition-transform duration-300" id="mobile-menu-content">
            <ul class="flex flex-col text-center text-2xl font-display">
              <li><a href="/portfolio" class="text-gray-900 hover:text-gray-600 transition-colors duration-300 block py-8">portfolio</a></li>
              <li><a href="/about" class="text-gray-900 hover:text-gray-600 transition-colors duration-300 block py-8">about</a></li>
              <li><a href="/contact" class="text-gray-900 hover:text-gray-600 transition-colors duration-300 block py-8">contact</a></li>
            </ul>
          </div>
        </div>
      </nav>
    </header>
    )}

    <main class={`flex-1 w-full ${heroMode ? '' : 'container-px max-w-5xl mx-auto pt-8'}`}>
      <slot />
    </main>

    {!isHomepage && <Footer />}

    <script>
      // Page transition system
      function initPageTransitions() {
        const links = document.querySelectorAll('a[href^="/"]');
        const transition = document.getElementById('pageTransition');
        const currentTheme = document.body.getAttribute('data-page-theme');
        
        if (!transition) return;
        
        links.forEach(link => {
          link.addEventListener('click', (e) => {
            e.preventDefault();
            const href = link.getAttribute('href');
            
            if (!href) return;
            
            // Determine target theme
            const isGoingToHome = href === '/';
            const targetTheme = isGoingToHome ? 'dark' : 'light';
            
            // Only show transition if changing themes
            if (currentTheme !== targetTheme) {
              // Mark navigation direction for animations
              if (isGoingToHome) {
                sessionStorage.setItem('toIndex', 'true');
              } else {
                sessionStorage.setItem('fromIndex', 'true');
              }
              
              // Set transition overlay to target theme color
              if (targetTheme === 'dark') {
                transition.classList.add('dark');
              } else {
                transition.classList.remove('dark');
              }
              
              transition.classList.add('active');
              
              setTimeout(() => {
                window.location.href = href;
              }, 200);
            } else {
              // Same theme - navigate immediately without transition
              window.location.href = href;
            }
          });
        });
      }
      
      // Initialize on page load
      document.addEventListener('DOMContentLoaded', initPageTransitions);
      
      // Mobile menu functionality
      function initMobileMenu() {
        const mobileMenuBtn = document.getElementById('mobile-menu-btn');
        const mobileMenu = document.getElementById('mobile-menu');
        const burgerLine1 = document.getElementById('burger-line-1');
        const burgerLine2 = document.getElementById('burger-line-2');
        const burgerLine3 = document.getElementById('burger-line-3');
        
        if (!mobileMenuBtn || !mobileMenu) return;
        
        let isOpen = false;
        
        mobileMenuBtn.addEventListener('click', () => {
          isOpen = !isOpen;
          
          if (isOpen) {
            // Show menu
            mobileMenu.classList.remove('hidden');
            const mobileMenuContent = document.getElementById('mobile-menu-content');
            
            // Trigger animation after a small delay to ensure display is set
            setTimeout(() => {
              mobileMenu.classList.remove('opacity-0');
              mobileMenu.classList.add('opacity-100');
              if (mobileMenuContent) {
                mobileMenuContent.classList.remove('translate-y-4');
                mobileMenuContent.classList.add('translate-y-0');
              }
            }, 10);
            
            // Animate to X
            if (burgerLine1) {
              burgerLine1.style.transform = 'rotate(45deg) translate(3px, 3px)';
            }
            if (burgerLine2) {
              burgerLine2.style.opacity = '0';
            }
            if (burgerLine3) {
              burgerLine3.style.transform = 'rotate(-45deg) translate(3px, -3px)';
            }
          } else {
            // Hide menu with animation
            const mobileMenuContent = document.getElementById('mobile-menu-content');
            mobileMenu.classList.remove('opacity-100');
            mobileMenu.classList.add('opacity-0');
            if (mobileMenuContent) {
              mobileMenuContent.classList.remove('translate-y-0');
              mobileMenuContent.classList.add('translate-y-4');
            }
            
            // Hide menu after animation completes
            setTimeout(() => {
              mobileMenu.classList.add('hidden');
            }, 300);
            
            // Animate back to hamburger
            if (burgerLine1) {
              burgerLine1.style.transform = '';
            }
            if (burgerLine2) {
              burgerLine2.style.opacity = '1';
            }
            if (burgerLine3) {
              burgerLine3.style.transform = '';
            }
          }
        });
        
        // Close menu when clicking outside
        document.addEventListener('click', (e) => {
          if (isOpen && !mobileMenuBtn.contains(e.target as Node) && !mobileMenu.contains(e.target as Node)) {
            mobileMenuBtn.click();
          }
        });
      }
      
      // Initialize mobile menu
      document.addEventListener('DOMContentLoaded', initMobileMenu);
      
      // Handle navbar fade-in animation
      function handleNavbarFadeIn() {
        const navbar = document.getElementById('navbar');
        
        if (navbar && sessionStorage.getItem('fromIndex') === 'true') {
          // Clear the flag immediately
          sessionStorage.removeItem('fromIndex');
          
          // Force navbar to start hidden
          navbar.style.opacity = '0';
          navbar.style.transform = 'translateY(-10px)';
          navbar.style.transition = 'none';
          
          // Use requestAnimationFrame to ensure DOM is ready
          requestAnimationFrame(() => {
            requestAnimationFrame(() => {
              navbar.style.transition = '';
              navbar.classList.add('navbar-fade-in');
            });
          });
        }
      }
      
      // Try on both DOMContentLoaded and load events for reliability
      document.addEventListener('DOMContentLoaded', handleNavbarFadeIn);
      
      // Fade out transition overlay on page load
      window.addEventListener('load', () => {
        const transition = document.getElementById('pageTransition');
        
        if (transition) {
          setTimeout(() => {
            transition.classList.remove('active');
          }, 50);
        }
        
        // Fallback: try navbar animation again on load if it didn't work on DOMContentLoaded
        handleNavbarFadeIn();
      });
    </script>
  </body>
</html>
