---
// src/components/ScrollAnimator.astro
---
<div class="scroll-animator">
  <slot />
</div>

<script>
  import gsap from "gsap";

  // This script will apply to each instance of the component individually.
  document.addEventListener('astro:page-load', () => {
    const animators = document.querySelectorAll('.scroll-animator');

    // Create a new Intersection Observer
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        // If the element is intersecting (visible)
        if (entry.isIntersecting) {
          // Animate it using GSAP
          gsap.to(entry.target, {
            opacity: 1,
            y: 0,
            duration: 0.8,
            ease: 'power3.out',
          });
          // Stop observing it once the animation has been triggered
          observer.unobserve(entry.target);
        }
      });
    }, {
      // Trigger the animation when the element is 20% visible
      threshold: 0.2
    });

    // Tell the observer to watch each animator element
    animators.forEach(animator => {
      // Set the initial state (invisible)
      gsap.set(animator, { opacity: 0, y: 50 });
      observer.observe(animator);
    });
  });
</script>